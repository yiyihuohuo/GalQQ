<?xml version="1.0" encoding="utf-8"?>
<PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android">

    <SwitchPreference
        android:key="gal_enabled"
        android:title="@string/gal_enabled_title"
        android:summary="@string/gal_enabled_summary"
        android:defaultValue="true" />

    <PreferenceCategory android:title="@string/gal_ai_cat_title">
        <SwitchPreference
            android:key="gal_ai_enabled"
            android:title="@string/gal_ai_enabled_title"
            android:summary="@string/gal_ai_enabled_summary"
            android:defaultValue="false" />

        <Preference
            android:key="gal_prompt_manager"
            android:title="提示词管理"
            android:summary="管理多个提示词，点击切换不同风格" />

        <EditTextPreference
            android:key="gal_api_url"
            android:title="@string/gal_api_url_title"
            android:summary="@string/gal_api_url_summary"
            android:defaultValue="" />

        <EditTextPreference
            android:key="gal_api_key"
            android:title="@string/gal_api_key_title"
            android:summary="@string/gal_api_key_summary"
            android:inputType="textPassword"
            android:defaultValue="" />
        
        <Preference
            android:key="gal_ai_model"
            android:title="@string/gal_ai_model_title"
            android:summary="点击选择或自定义模型" />
        
        <ListPreference
            android:key="gal_ai_provider"
            android:title="@string/gal_ai_provider_title"
            android:summary="@string/gal_ai_provider_summary"
            android:entries="@array/ai_provider_names"
            android:entryValues="@array/ai_provider_values"
            android:defaultValue="openai" />
        
        <EditTextPreference
            android:key="gal_ai_temperature"
            android:title="@string/gal_ai_temperature_title"
            android:summary="@string/gal_ai_temperature_summary"
            android:inputType="numberDecimal"
            android:defaultValue="0.8" />
        
        <EditTextPreference
            android:key="gal_ai_max_tokens"
            android:title="@string/gal_ai_max_tokens_title"
            android:summary="@string/gal_ai_max_tokens_summary"
            android:inputType="number"
            android:defaultValue="120" />
        
        <ListPreference
            android:key="gal_ai_reasoning_effort"
            android:title="思考模式 (reasoning_effort)"
            android:summary="并不是所有模型都支持此参数，可以选择关闭"
            android:entries="@array/reasoning_effort_names"
            android:entryValues="@array/reasoning_effort_values"
            android:defaultValue="off" />
            
        <EditTextPreference
            android:key="gal_ai_qps"
            android:title="请求速率 (QPS)"
            android:summary="每秒最大请求数 (默认: 3.0)，当遇到发送太多的错误时会自动降低"
            android:inputType="numberDecimal"
            android:defaultValue="3.0" />
        
        <EditTextPreference
            android:key="gal_ai_timeout"
            android:title="请求超时时间"
            android:summary="AI API请求超时时间（秒），默认30秒，读取超时为2倍"
            android:inputType="number"
            android:defaultValue="30" />
        
        <Preference
            android:key="gal_test_api"
            android:title="@string/gal_test_api_title"
            android:summary="@string/gal_test_api_summary" />
        
        <SwitchPreference
            android:key="gal_verbose_log"
            android:title="详细日志"
            android:summary="记录完整的API请求包（包含Headers和Body）"
            android:defaultValue="false" />
        
        <SwitchPreference
            android:key="gal_debug_hook_log"
            android:title="调试Hook日志"
            android:summary="记录消息发送、引用回复等Hook调用的详细日志（用于开发调试）"
            android:defaultValue="false" />
        
        
        <Preference
            android:key="gal_ai_log"
            android:title="@string/gal_ai_log_title"
            android:summary="@string/gal_ai_log_summary" />
            
        <Preference
            android:key="gal_ai_monitor"
            android:title="当前请求监控"
            android:summary="查看当前队列状态、QPS和正在处理的请求" />
        
        <SwitchPreference
            android:key="gal_context_enabled"
            android:title="启用对话上下文"
            android:summary="发送历史消息给AI，生成更贴合语境的回复"
            android:defaultValue="true" />
        
        <EditTextPreference
            android:key="gal_context_message_count"
            android:title="上下文消息数"
            android:summary="发送给AI的历史消息条数（1-200）"
            android:inputType="number"
            android:defaultValue="15" />
        
        <EditTextPreference
            android:key="gal_history_threshold"
            android:title="历史消息阈值"
            android:summary="超过此时间（秒）的消息不触发AI（默认：600秒 = 10分钟）"
            android:inputType="number"
            android:defaultValue="600" />
    </PreferenceCategory>
    
    <PreferenceCategory android:title="代理设置">
        <SwitchPreference
            android:key="gal_proxy_enabled"
            android:title="启用代理"
            android:summary="通过代理服务器访问AI接口"
            android:defaultValue="false" />
        
        <ListPreference
            android:key="gal_proxy_type"
            android:title="代理类型"
            android:entries="@array/proxy_type_names"
            android:entryValues="@array/proxy_type_values"
            android:defaultValue="HTTP"
            android:summary="选择代理协议类型"
            android:dependency="gal_proxy_enabled" />
        
        <EditTextPreference
            android:key="gal_proxy_host"
            android:title="代理地址"
            android:summary="代理服务器IP（如电脑IP 192.168.x.x，手机本地用 127.0.0.1）"
            android:defaultValue=""
            android:dependency="gal_proxy_enabled" />
        
        <EditTextPreference
            android:key="gal_proxy_port"
            android:title="代理端口"
            android:summary="代理服务器端口（如 7890）"
            android:inputType="number"
            android:defaultValue="7890"
            android:dependency="gal_proxy_enabled" />
        
        <SwitchPreference
            android:key="gal_proxy_auth_enabled"
            android:title="启用代理认证"
            android:summary="代理服务器需要用户名密码"
            android:defaultValue="false"
            android:dependency="gal_proxy_enabled" />
        
        <EditTextPreference
            android:key="gal_proxy_username"
            android:title="代理用户名"
            android:summary="代理认证用户名"
            android:defaultValue=""
            android:dependency="gal_proxy_auth_enabled" />
        
        <EditTextPreference
            android:key="gal_proxy_password"
            android:title="代理密码"
            android:summary="代理认证密码"
            android:inputType="textPassword"
            android:defaultValue=""
            android:dependency="gal_proxy_auth_enabled" />
        
        <Preference
            android:key="gal_test_proxy"
            android:title="测试代理连接"
            android:summary="测试代理配置是否正常工作"
            android:dependency="gal_proxy_enabled" />
    </PreferenceCategory>

    <PreferenceCategory android:title="过滤设置">
        <ListPreference
            android:key="gal_filter_mode"
            android:title="过滤模式"
            android:entries="@array/filter_mode_names"
            android:entryValues="@array/filter_mode_values"
            android:defaultValue="blacklist"
            android:summary="选择用户黑名单或用户白名单模式" />
        
        <EditTextPreference
            android:key="gal_blacklist"
            android:title="用户黑名单"
            android:summary="不显示选项条的QQ号（逗号分隔）"
            android:defaultValue="" />
        
        <EditTextPreference
            android:key="gal_whitelist"
            android:title="用户白名单"
            android:summary="仅显示选项条的QQ号（逗号分隔）"
            android:defaultValue="" />
        
        <ListPreference
            android:key="gal_group_filter_mode"
            android:title="群过滤模式"
            android:entries="@array/filter_mode_names"
            android:entryValues="@array/filter_mode_values"
            android:defaultValue="blacklist"
            android:summary="选择群黑名单或群白名单模式" />
        
        <EditTextPreference
            android:key="gal_group_blacklist"
            android:title="群黑名单"
            android:summary="不显示选项条的群号（逗号分隔）"
            android:defaultValue="" />
        
        <EditTextPreference
            android:key="gal_group_whitelist"
            android:title="群白名单"
            android:summary="仅显示选项条的群号（逗号分隔）"
            android:defaultValue="" />
    </PreferenceCategory>

    <PreferenceCategory android:title="图片识别">
        <SwitchPreference
            android:key="gal_image_recognition_enabled"
            android:title="启用图片识别"
            android:summary="识别聊天消息中的图片内容，将描述发送给AI"
            android:defaultValue="false" />
        
        <!-- 暂时注释掉表情包识别功能
        <SwitchPreference
            android:key="gal_emoji_recognition_enabled"
            android:title="启用表情包识别"
            android:summary="识别QQ表情包，将描述发送给AI"
            android:defaultValue="false" />
        -->
        
        <SwitchPreference
            android:key="gal_context_image_recognition_enabled"
            android:title="识别上下文图片"
            android:summary="识别上下文中所有消息的图片（会增加API调用次数，受速率限制）"
            android:defaultValue="false"
            android:dependency="gal_image_recognition_enabled" />
        
        <SwitchPreference
            android:key="gal_vision_ai_enabled"
            android:title="启用外挂AI"
            android:summary="使用独立的AI服务进行图片识别（主AI不支持视觉时使用）"
            android:defaultValue="false"
            android:dependency="gal_image_recognition_enabled" />
        
        <ListPreference
            android:key="gal_vision_ai_provider"
            android:title="外挂AI服务商"
            android:summary="选择图片识别AI服务商"
            android:entries="@array/vision_ai_provider_names"
            android:entryValues="@array/vision_ai_provider_values"
            android:defaultValue="openai"
            android:dependency="gal_vision_ai_enabled" />
        
        <EditTextPreference
            android:key="gal_vision_api_url"
            android:title="外挂AI API URL"
            android:summary="图片识别API地址"
            android:defaultValue=""
            android:dependency="gal_vision_ai_enabled" />
        
        <EditTextPreference
            android:key="gal_vision_api_key"
            android:title="外挂AI API Key"
            android:summary="图片识别API密钥"
            android:inputType="textPassword"
            android:defaultValue=""
            android:dependency="gal_vision_ai_enabled" />
        
        <EditTextPreference
            android:key="gal_vision_ai_model"
            android:title="外挂AI模型"
            android:summary="图片识别模型名称（如 gpt-4-vision-preview）"
            android:defaultValue="gpt-4-vision-preview"
            android:dependency="gal_vision_ai_enabled" />
        
        <SwitchPreference
            android:key="gal_vision_use_proxy"
            android:title="外挂AI使用代理"
            android:summary="图片识别请求是否使用主代理配置"
            android:defaultValue="false"
            android:dependency="gal_proxy_enabled" />
        
        <EditTextPreference
            android:key="gal_vision_ai_qps"
            android:title="外挂AI请求速率 (QPS)"
            android:summary="外挂AI每秒最大请求数（默认: 1.0，图片识别较慢建议不要太高）"
            android:inputType="numberDecimal"
            android:defaultValue="1.0"
            android:dependency="gal_vision_ai_enabled" />
        
        <Preference
            android:key="gal_test_vision_ai"
            android:title="测试外挂AI"
            android:summary="使用测试图片验证外挂AI配置"
            android:dependency="gal_vision_ai_enabled" />
        
        <EditTextPreference
            android:key="gal_image_max_size"
            android:title="图片大小限制"
            android:summary="最大处理图片大小（KB），默认2048KB"
            android:inputType="number"
            android:defaultValue="2048"
            android:dependency="gal_image_recognition_enabled" />
        
        <EditTextPreference
            android:key="gal_image_description_max_length"
            android:title="描述长度限制"
            android:summary="图片描述最大字符数，默认200"
            android:inputType="number"
            android:defaultValue="200"
            android:dependency="gal_image_recognition_enabled" />
        
        <EditTextPreference
            android:key="gal_vision_timeout"
            android:title="识别超时时间"
            android:summary="图片识别超时时间（秒），默认30秒"
            android:inputType="number"
            android:defaultValue="30"
            android:dependency="gal_image_recognition_enabled" />
    </PreferenceCategory>

    <PreferenceCategory android:title="@string/gal_display_cat_title">
        <SwitchPreference
            android:key="gal_auto_show_options"
            android:title="@string/gal_auto_show_title"
            android:summary="@string/gal_auto_show_summary"
            android:defaultValue="false" />
        
        <SwitchPreference
            android:key="gal_disable_group_options"
            android:title="关闭群聊选项显示"
            android:summary="在群聊中不显示选项条和按钮（私聊不受影响）"
            android:defaultValue="false" />
        
        <SwitchPreference
            android:key="gal_affinity_enabled"
            android:title="显示好感度"
            android:summary="在消息发送者头像旁显示好感度数值（基于QQ空间亲密度，测试功能未实现完全适配，可能存在无法完全获取好感度的问题）"
            android:defaultValue="false" />
        
        <ListPreference
            android:key="gal_affinity_model"
            android:title="好感度计算模型"
            android:entries="@array/affinity_model_names"
            android:entryValues="@array/affinity_model_values"
            android:defaultValue="2"
            android:summary="选择好感度计算方式" />
        
        <Preference
            android:key="gal_test_affinity"
            android:title="测试好感度数据获取"
            android:summary="测试Cookie和亲密度API是否正常工作" />
    </PreferenceCategory>

    <PreferenceCategory android:title="@string/gal_dict_cat_title">
        <EditTextPreference
            android:key="gal_dict_path"
            android:title="@string/gal_dict_path_title"
            android:summary="@string/gal_dict_path_summary"
            android:defaultValue="" />
    </PreferenceCategory>

    <PreferenceCategory android:title="@string/gal_about_cat_title">
        <Preference
            android:key="gal_source"
            android:title="开源地址"
            android:summary="https://github.com/yiyihuohuo/GalQQ" />
        
        <Preference
            android:key="gal_join_group"
            android:title="加入交流群"
            android:summary="点击加入 859142525" />
            
        <Preference
            android:key="gal_version"
            android:title="版本号"
            android:summary="1.0.6 Alpha" />
            
        <Preference
            android:key="gal_developer"
            android:title="开发者"
            android:summary="Huo" />
    </PreferenceCategory>

</PreferenceScreen>
